var FDGrid=function(a){this.viewInstance;this.modelInstance;this.options=FDLib.util.apply(this.getOptions(),a);if(!this.getPageSize()){this.setPageSize(this.options.pageSizeParam[0])}this.registView();this.registModel();if(this.options.loadSearch){this.search()}};FDGrid.prototype={getOptions:function(){var a=this;return{domId:"",url:"",id:null,width:"",height:"",noDataText:"无查询结果",columns:[],columnDefaultStyle:{width:"100px"},fitColumns:true,actionColumnConfig:{text:"操作",style:{textAlign:"center"}},actionButtons:[],selectOption:{multiSelect:false,singleSelect:false,onclick:function(d,b,c,e){},onload:function(d,b,c,e){},hideCheckAll:false,cache:false},selectCache:{},gridDomMap:{tbody_0:null,table_1:null,tableDiv_2:null,gridDiv_3:null,headThead_0:null,pageDiv_3:null,paginTable_2:null,paginTfoot_1:null},rowRender:function(b,c,d){},view:GlobalParams.defalutView,model:GlobalParams.defalutModel,showPaging:true,showSetting:true,pageCount:0,pageIndex:1,total:0,pageSizeParam:[10,20,30],pageSize:0,schData:{},result:null,data:null,sortName:null,sortOrder:"DESC",loadSearch:true,getGrid:function(){return a},selectRowClassName:"ui-state-active",clickRowClassName:"ui-state-highlight",onBeforeLoad:function(b){return true},onLoadSuccess:function(b){return b},afterRefresh:function(b){},onClickRow:function(b,c){}}},registView:function(){var a=this.options.view;this.viewInstance=new a(this.options,this)},_initDecorators:function(c){var b=this.options.decorators;var a=this;FDLib.util.each(b,function(d){c=new d(c,a)});return c},registModel:function(){var a=this.options.model;this.modelInstance=new a()},search:function(a){if(this.options.url){this.options.schData=a||{};this.options.pageIndex=1}this.resetSelectCache();this.refresh()},resetSelectCache:function(){if(this.isSelectable()){this.options.selectCache={}}},getSelectCache:function(){return this.options.selectCache},loadData:function(a){this.options.data=a;this.resetParam();this.refresh()},getData:function(){return this.options.result},getRowData:function(a){return this.getRows()[a]},getRows:function(){return this.getData()[GlobalParams.serverRowsName]||[]},getChecked:function(){if(this.multiSelect()){var c=this.options.id;var d=[];var g=this.getRows();var b=this;var e=this.options.selectOption.cache;if(e){var a=this.getSelectCache();for(var f in a){if(a[f]){d.push(a[f])}}}FDLib.util.each(g,function(l,k){var h=b.getSelectorByRowIndex(k);var j=b.isInCache(l,c);if(h&&h.checked&&!j){d.push(l)}});return d}},isInCache:function(c,a){if(!a){return false}var b=c[a];return !!this.options.selectCache[b]},getCheckedLength:function(){var a=this.getChecked();if(!a){return 0}return a.length},getSelected:function(){if(this.singleSelect()){var e=this.getRows();var b=this;var c=this.options.selectOption.cache;if(c){var a=this.getSelectCache();for(var d in a){if(a[d]){return a[d]}}}return FDLib.util.each(e,function(h,g){var f=b.getSelectorByRowIndex(g);if(f&&f.checked){return h}})}},checkAll:function(){if(this.multiSelect()){var a=this._getSelectAllInput();if(a){a.checked="checked";a.onclick()}}},uncheckAll:function(){if(this.multiSelect()){var a=this._getSelectAllInput();if(a){a.checked="";a.onclick()}}},selectRow:function(a){this.setSelected(a)},setUrl:function(a){this.options.url=a},selectRecord:function(e){var b=this.getTableTR();var d=b.length;for(var c=0;c<d;c++){var a=this.getSelectorByRowIndex(c);if(a.value==e){this.setSelected(c);break}}},checkRow:function(a){this.setSelected(a)},uncheckRow:function(a){this.setNoSelected(a)},clearChecked:function(){this.uncheckAll()},_doSelectHandler:function(a,b){if(a.disabled){return}if(this.singleSelect()){this._bindSingleSelectRow(b)}FDLib.dom.removeClass(b,this.options.clickRowClassName);FDLib.dom.addClass(b,this.options.selectRowClassName)},_noSelectedHandler:function(a,b){var d=this.getTableTR();if(a.disabled){return}var c=d[b];this._doNoSelectedHandler(a,c)},_doNoSelectedHandler:function(a,b){if(a.disabled){return}a.checked="";FDLib.dom.removeClass(b,this.options.selectRowClassName)},_bindSingleSelectRow:function(a){if(this.lastRadioSelectedTR){FDLib.dom.removeClass(this.lastRadioSelectedTR,this.options.selectRowClassName)}this.lastRadioSelectedTR=a},_bindClickRowClass:function(a){if(this.lastClickedTR){FDLib.dom.removeClass(this.lastClickedTR,this.options.clickRowClassName)}if(FDLib.dom.hasClass(a,this.options.selectRowClassName)){return}this.lastClickedTR=a;FDLib.dom.addClass(a,this.options.clickRowClassName)},getTableTR:function(){return this.options.gridDomMap.tbody_0.rows},buildParam:function(){var a=this.options.schData||{};a[GlobalParams.requestPageIndexName]=this.getPageIndex();a[GlobalParams.requestPageSizeName]=this.getPageSize();if(this.options.sortName){a[GlobalParams.requestSortName]=this.options.sortName;a[GlobalParams.requestOrderName]=this.options.sortOrder}return a},sort:function(b,a){this.options.sortName=b;this.options.sortOrder=a;this.refresh()},getSortOrder:function(){return this.options.sortOrder},getSortName:function(){return this.options.sortName},getThead:function(){return this.options.gridDomMap.headThead_0},getTbody:function(){return this.options.gridDomMap.tbody_0},postData:function(){if(this.options.url){var d=this.buildParam();var b=this;var c=this.options.onBeforeLoad(d);if(c){this.modelInstance.postData(this.options.url,d,function(e){b.options.result=b.options.onLoadSuccess(e);b.callViewsProcess()})}}else{if(this.options.data){var a=this.requestLocal(this.getPageIndex(),this.getPageSize());a=this.options.onLoadSuccess(a);this.options.result=a;this.callViewsProcess()}}this.options.afterRefresh(this.options.result)},getPageIndex:function(){return this.options.pageIndex},getPageSize:function(){return this.options.pageSize},setPageIndex:function(a){this.options.pageIndex=a},setPageSize:function(a){this.options.pageSize=a},requestLocal:function(a,c){var d=[];var f=this.options.data;var b=1,e=0;if(this.options.showPaging){b=parseInt((a-1)*c);e=f.length;d=f.slice(b,b+c)}else{d=f}var g={};g[GlobalParams.serverRowsName]=d;g[GlobalParams.serverPageIndexName]=a;g[GlobalParams.serverPageSizeName]=c;g[GlobalParams.serverTotalName]=e;return g},callViewsProcess:function(){this.viewInstance.processData(this.options.result)},refresh:function(){this.postData();this.reset()},reload:function(){this.resetParams();this.search()},resetParams:function(){this.options.pageIndex=1;this.options.schData={}},reset:function(){if(this.multiSelect()){var a=this._getSelectAllInput();if(a){a.checked=""}}},resetParam:function(){this.options.pageIndex=1},deleteRow:function(c){var b=this.options.data||{};var a=b[GlobalParams.serverRowsName];if(a.length>c){a.splice(c,1);this.refresh()}},isSelectable:function(){return this.singleSelect()||this.multiSelect()},isSelectStatus:function(){return this.isSelectable()},singleSelect:function(){var a=this.options.selectOption;return a.singleSelect},multiSelect:function(){var a=this.options.selectOption;return a.multiSelect},_getSelectAllInput:function(){if(this.multiSelect()){return this.checkAllInput}},getSelectorByRowIndex:function(b){if(this.isSelectable()){var a=this.getTableTR();return this._getInput(a,b)}},_getInput:function(b,d){var c=b[d];var a=c.cells[0];return a.getElementsByTagName("input")[0]},_couldOperateSelector:function(a){return a&&!a.disabled},_getTable:function(){return this.options.gridDomMap.table_1},setSelected:function(b){var a=this.getSelectorByRowIndex(b);if(a.disabled){return}a.checked="checked";a.onclick()},setNoSelected:function(b){var a=this.getSelectorByRowIndex(b);if(a.disabled){return}a.checked="";a.onclick()},clearSelected:function(){if(this.singleSelect()){var b=this.getTableTR();var d=b.length;var e=null;for(var c=0;c<d;c++){e=b[c];var a=this.getSelectorByRowIndex(c);if(a.checked){this._doNoSelectedHandler(a,e);break}}}},getDataLength:function(){return this.getRows().length},setRowDisabled:function(b){var a=this.getSelectorByRowIndex(b);if(a){a.disabled="disabled"}},setRowEnabled:function(b){var a=this.getSelectorByRowIndex(b);if(a){a.disabled=""}},moveFirst:function(){if(this.options.pageIndex!=1){this.options.pageIndex=1;this.refresh()}},movePreview:function(){if(this.options.pageIndex>1){this.options.pageIndex--;this.refresh()}},moveNext:function(){if(this.options.pageIndex<this.options.pageCount){this.options.pageIndex++;this.refresh()}},moveLast:function(){if(this.options.pageIndex!=this.options.pageCount){this.options.pageIndex=this.options.pageCount;this.refresh()}}};