var FDTreeDomView=function(a){this.options=a;this.childrenFieldName=a.childrenFieldName;this.valueFieldName=a.valueFieldName;this.textFieldName=a.textFieldName;this.onCheck=a.onCheck||function(){};this.selectedId=null;this.treePanel=this.buildTreePanel();this.togglers=[];this.idNodeMap={};this.idDataMap={}};FDTreeDomView.prototype={refresh:function(a){if(a){var b=this.buildUL(a,"pui-tree-container");this.treePanel.innerHTML="";this.treePanel.appendChild(b);this.render()}},hide:function(){FDLib.dom.hideDom(this.treePanel)},show:function(){FDLib.dom.showDom(this.treePanel)},buildUL:function(d,g,c){var f=document.createElement(FDTag.UL);f.className=g;for(var e=0,b=d.length;e<b;e++){var a=this.buildLi(d[e]);f.appendChild(a);if(c){a.parentLi=c}}return f},buildLi:function(d){var a=document.createElement(FDTag.LI);var f="pui-treenode"+(this._isOpen(d)?" pui-treenode-expanded":"");var c=this.buildNodeDisplay(d,a);a.appendChild(c);if(this.hasChild(d)){a.isParent=true;f+=" pui-treenode-parent";var e=this.getChildren(d);var b=this.buildChildren(e,a);a.toggler.childrenUL=b;a.appendChild(b)}a.className=f;this.storeNode(d,a);return a},buildChildren:function(c,a){var b=this.buildUL(c,"pui-treenode-children",a);b.style.display="none";return b},buildNodeDisplay:function(g,a){var b=document.createElement(FDTag.SPAN);b.className="pui-treenode-content pui-treenode-selectable";var f=this.buildToggler(g);var d=this.buildIcon(g,f);var e=this.buildCheckbox(g);var c=this.buildLabel(g,f);this.togglers.push(f);b.appendChild(f);if(d){b.appendChild(d)}if(e){b.appendChild(e)}b.appendChild(c);a.toggler=f;a.icon=d;a.lab=c;return b},storeNode:function(b,a){this.idNodeMap[this.getId(b)]=a},getNode:function(a){return this.idNodeMap[a]},buildToggler:function(d){var b="pui-tree-toggler ui-icon "+((d.state&&"open"==d.state)?this.getOpenClassName():this.getCloseClassName());if(!this.hasChild(d)){b="pui-treenode-leaf-icon"}var a=this._createNodeSpan(b);var c=this;a.onclick=function(){c.toggle(this,d)};return a},buildIcon:function(e,d){var a=e.iconCls;if(a){var c="pui-treenode-icon ui-icon "+(a?a:"");var b=this._createNodeSpan(c);FDLib.event.addEvent(b,"click",function(){d.onclick()});return b}return null},buildLabel:function(g,f){var c="pui-treenode-label ui-corner-all";var b=this._createNodeSpan(c,this.getText(g));var h=this.options.clickToggle;var d=this;var a=true;var e=this.options.hoverEffectHandler;if(FDLib.util.isFunction(e)){a=e(g,b)}if(a){FDLib.addHoverEffect(b)}b.onclick=function(){if(h){f.onclick()}if(d.options.onclick){d.options.onclick(g)}d.setClickHighlight(b,g)};return b},buildCheckbox:function(d,a){if(this.options.checkable){var b=this;var c=document.createElement(FDTag.INPUT);c.type="checkbox";c.value=d[this.valueFieldName];c.data=d;c.onclick=function(){b.onCheck(d,this.checked);b.checkChildren(this,d,this.checked)};return c}},checkChildren:function(d,g,h){var c=this.getNode(g[this.valueFieldName]);var b=c.getElementsByTagName("input");for(var e=0,a=b.length;e<a;e++){var f=b[e];if(d==f){continue}f.checked=h;this.onCheck(f.data,h)}},getId:function(a){var b=a[this.valueFieldName];if(!b){a[this.valueFieldName]="tree_node_"+FDControl.generateCount()}return a[this.valueFieldName]},storeData:function(a){var b=this.getId(a);this.idDataMap[b]=a},getRowDataById:function(a){return this.idDataMap[a]},getText:function(a){if(this.options.render){return this.options.render(a)}return a[this.textFieldName]},getOpenClassName:function(){return"ui-icon-triangle-1-s"},getCloseClassName:function(){return"ui-icon-triangle-1-e"},expandParent:function(b){var a=b.parentLi;if(b&&a){this.expandByLi(a);this.expandParent(a)}},expandByLi:function(a){var b=a.toggler;if(a&&a.isParent&&b){this.expand(b)}},select:function(d,c){this.selectedId=d;var b=this.getRowDataById(d);var a=this.getNode(d);this.expandByLi(a);this.expandParent(a);c&&c(b);a.lab.onclick()},getSelected:function(){return this.getRowDataById(this.selectedId)},getChecked:function(f){var d=[];var e=this.treePanel.getElementsByTagName("input");for(var b=0,a=e.length;b<a;b++){var c=e[b];if(c.checked){d.push(c.data)}}return d},getUnChecked:function(){var d=[];var e=this.treePanel.getElementsByTagName("input");for(var b=0,a=e.length;b<a;b++){var c=e[b];if(!c.checked){d.push(c.data)}}return d},check:function(f,h){var g=this.treePanel.getElementsByTagName("input");for(var d=0,a=g.length;d<a;d++){var e=g[d];for(var c=0,b=f.length;c<b;c++){if(f[c]==e.value){e.checked=true;this.onCheck(e.data,e.checked);h&&h(e.data,e)}}}},uncheck:function(f,h){var g=this.treePanel.getElementsByTagName("input");for(var d=0,a=g.length;d<a;d++){var e=g[d];for(var c=0,b=f.length;c<b;c++){if(f[c]==e.value){e.checked=false;this.onCheck(e.data,e.checked);h&&h(e.data,e)}}}},checkAll:function(e){var d=this.treePanel.getElementsByTagName("input");for(var b=0,a=d.length;b<a;b++){var c=d[b];c.checked=true;this.onCheck(c.data,c.checked);e&&e(c.data,c)}},uncheckAll:function(e){var d=this.treePanel.getElementsByTagName("input");for(var b=0,a=d.length;b<a;b++){var c=d[b];c.checked=false;this.onCheck(c.data,c.checked);e&&e(c.data,c)}},checkOthers:function(e){var d=this.treePanel.getElementsByTagName("input");for(var b=0,a=d.length;b<a;b++){var c=d[b];c.checked=!c.checked;this.onCheck(c.data,c.checked);e&&e(c.data,c)}},setClickHighlight:function(d,c){var a=true;var b=this.options.highlightHandler;if(FDLib.util.isFunction(b)){a=b(c,d)}if(a){this.doClickHighlight(d)}},doClickHighlight:function(a){if(this.lastClickSpan){FDLib.dom.removeClass(this.lastClickSpan,"ui-state-highlight")}this.lastClickSpan=a;FDLib.dom.addClass(a,"ui-state-highlight")},toggle:function(b,a){if(this._isOpen(b)){this.collapse(b);a.state="closed"}else{this.expand(b);a.state="open"}},expandAll:function(){for(var b=0,a=this.togglers.length;b<a;b++){this.expand(this.togglers[b])}},collapseAll:function(){for(var b=0,a=this.togglers.length;b<a;b++){this.collapse(this.togglers[b])}},expand:function(b){b.state="open";var a=b.childrenUL;if(a){FDLib.dom.removeClass(b,this.getCloseClassName());FDLib.dom.addClass(b,this.getOpenClassName());a.style.display="block"}},collapse:function(b){b.state="close";var a=b.childrenUL;if(a){FDLib.dom.removeClass(b,this.getOpenClassName());FDLib.dom.addClass(b,this.getCloseClassName());a.style.display="none"}},_isOpen:function(a){if(!a.state){return false}return a.state=="open"},_createNodeSpan:function(b,c){var a=document.createElement(FDTag.SPAN);a.className=b;if(c){a.innerHTML=c}return a},buildTreePanel:function(){var a=document.createElement(FDTag.DIV);a.className="pui-tree ui-widget ui-widget-content ui-corner-all";if(!this.options.showBorder){a.style.border="0px"}return a},hasChild:function(a){return this.getChildren(a).length>0},getChildren:function(a){return a[this.childrenFieldName]||[]},render:function(){if(FDRight.checkByCode(this.options.operateCode)){var a=FDLib.getEl(this.options.domId);a.innerHTML="";a.appendChild(this.treePanel)}}};